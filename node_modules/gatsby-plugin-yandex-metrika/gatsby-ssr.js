'use strict';

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.onRenderBody = function (_ref, pluginOptions) {
    var setPostBodyComponents = _ref.setPostBodyComponents;

    if (process.env.NODE_ENV === 'production') {
        // useBeta flag is set for metrika 2.0
        var useBeta = pluginOptions.version && pluginOptions.version === 2;
        var versionSuffix = useBeta ? '2' : '';
        var metrikaSrc = 'https://mc.yandex.ru/metrika/' + (useBeta ? 'tag' : 'watch') + '.js';

        return setPostBodyComponents([_react2.default.createElement('script', {
            key: 'gatsby-plugin-yandex-metrika',
            dangerouslySetInnerHTML: {
                __html: '\n(function (d, w, c) {\n    (w[c] = w[c] || []).push(function() {\n        try {\n            w.yaCounter = new Ya.Metrika' + versionSuffix + '({\n                id:' + pluginOptions.trackingId + ',\n                clickmap:true,\n                trackLinks:true,\n                accurateTrackBounce:true,\n                webvisor:' + pluginOptions.webvisor + ',\n                trackHash:' + pluginOptions.trackHash + '\n            });\n        } catch(e) { }\n    });\n\n    var n = d.getElementsByTagName("script")[0],\n        s = d.createElement("script"),\n        f = function () { n.parentNode.insertBefore(s, n); };\n    s.type = "text/javascript";\n    s.async = true;\n    s.src = "' + metrikaSrc + '";\n\n    if (w.opera == "[object Opera]") {\n        d.addEventListener("DOMContentLoaded", f, false);\n    } else { f(); }\n})(document, window, "yandex_metrika_callbacks' + versionSuffix + '");\n' } }), _react2.default.createElement(
            'noscript',
            null,
            _react2.default.createElement(
                'div',
                null,
                _react2.default.createElement('img', { src: 'https://mc.yandex.ru/watch/' + pluginOptions.trackingId, style: { position: 'absolute', left: '-9999px' }, alt: '' })
            )
        )]);
    }
};